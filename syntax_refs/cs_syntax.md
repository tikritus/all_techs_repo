# CrowdStrike FQL Cheat Sheet for Cybersecurity Investigations

This cheat sheet provides a quick reference to common CrowdStrike Falcon Query Language (FQL) components used in Event Search for cybersecurity analysis.

**Note:**
* Field names (`ComputerName`, `UserName`, `ProcessId_decimal`, `FileName`, `CommandLine`, `RemoteAddressIP4`, `TargetProcessId_decimal`, etc.) are examples. Refer to the CrowdStrike Falcon event schema for exact field names.
* Event types (`event_simpleName` or `EventType`) are crucial for scoping searches.
* FQL is case-sensitive for field names and event types, but generally case-insensitive for string values unless using exact match with quotes.

| Component Type         | FQL Component / Concept | Description                                                                                                | Example Usage (FQL)                                                                                                                                                              |
|------------------------|-------------------------|------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Core Searching** | (Implicit Search)       | Typing field-value pairs or keywords directly initiates a search.                                          | `#event_simpleName=ProcessRollup2 FileName=powershell.exe`                                                                                                                          |
|                        | `search` command        | Explicitly defines the start of a search, often used before pipes. (Though often implicit at the start).   | `search event_simpleName=ProcessRollup2`                                                                                                                                           |
| **Event Types** | `#event_simpleName`      | A human-readable name for the event type (e.g., `ProcessRollup2`, `NetworkConnectIP4`, `DnsRequest`).      | `#event_simpleName=DnsRequest DomainName="evil.com"`                                                                                                                                |
|                        | `EventType`             | Numerical identifier for an event type.                                                                    | `EventType=1` (Often corresponds to ProcessRollup2, check schema)                                                                                                                    |
| **Boolean Operators** | `AND`                   | Both conditions must be true. (Often implicit when listing multiple field-value pairs).                    | `FileName=cmd.exe AND ParentBaseFileName=winword.exe`                                                                                                                              |
|                        | `OR`                    | Either condition can be true.                                                                              | `FileName=mimikatz.exe OR FileName=psexec.exe`                                                                                                                                     |
|                        | `NOT`                   | Excludes events matching the condition.                                                                    | `#event_simpleName=NetworkConnectIP4 NOT RemoteAddressIP4="10.0.0.0/8"`                                                                                                               |
|                        | `()`                    | Parentheses for grouping conditions.                                                                       | `(FileName=powershell.exe OR FileName=cmd.exe) AND UserName!="SYSTEM"`                                                                                                             |
| **Comparison Operators**| `=`                   | Equal to (case-insensitive for string values unless quoted for exact match).                               | `UserName=administrator` <br> `TargetProcessId_decimal=4`                                                                                                                          |
|                        | `!=`                  | Not equal to.                                                                                              | `event_simpleName=UserLogon UserName!=SYSTEM`                                                                                                                                      |
|                        | `>`                   | Greater than.                                                                                              | `ProcessStartTime_time > "2023-10-26T10:00:00Z"` <br> `ContextProcessId_decimal > 0`                                                                                                 |
|                        | `>=`                  | Greater than or equal to.                                                                                  | `Size >= 1000000`                                                                                                                                                                  |
|                        | `<`                   | Less than.                                                                                                 | `ConnectionsCount < 5`                                                                                                                                                             |
|                        | `<=`                  | Less than or equal to.                                                                                     | `Severity <= 4`                                                                                                                                                                    |
| **Wildcards** | `*`                     | Matches any sequence of characters (including none). Can be used at beginning, middle, or end of a string. | `FileName=*.dll` <br> `CommandLine="*Invoke-Mimikatz*"` <br> `ComputerName=DEV-*`                                                                                                   |
|                        | `?`                     | Matches any single character. (Less commonly used than `*`)                                                | `FileName="file?.txt"`                                                                                                                                                             |
| **Value Lists** | `IN (...)`              | Matches any value in a specified list.                                                                     | `#event_simpleName IN (ProcessRollup2, SyntheticProcessRollup2)` <br> `TargetProcessId_decimal IN (1234, 5678)`                                                                         |
|                        | `NOT IN (...)`          | Excludes values in a specified list.                                                                       | `ContextProcessId_decimal NOT IN (0, 4)`                                                                                                                                           |
| **CIDR Notation** | (Field specific)        | Used with IP address fields to specify network ranges.                                                     | `RemoteAddressIP4="192.168.1.0/24"` <br> `LocalAddressIP4!="10.0.0.0/8"`                                                                                                             |
| **Field Existence** | `ISNULL(FieldName)`     | Checks if a field is null (has no value).                                                                  | `search event_simpleName=ProcessRollup2 | where ISNULL(ParentBaseFileName)`                                                                                                                   |
|                        | `ISNOTNULL(FieldName)`  | Checks if a field has a value (is not null).                                                               | `search event_simpleName=NetworkConnectIP4 | where ISNOTNULL(RemoteAddressIP4)`                                                                                                                  |
| **Table & Field Selection** | `table`             | Specifies which fields to display in the results table and their order.                                    | `... | table TimeGenerated_time, ComputerName, UserName, FileName, CommandLine`                                                                                                            |
| **Sorting Results** | `sort`                  | Sorts results by one or more fields. Use `-` for descending order.                                         | `... | sort -TimeGenerated_time` <br> `... | sort UserName, -ProcessStartTime_time`                                                                                              |
| **Aggregation & Grouping** | `stats`             | Calculates aggregate statistics grouped by specified fields.                                               | `... | stats count() by UserName, FileName` <br> `... | stats dc(RemoteAddressIP4) as UniqueDestIPs by ComputerName`                                                                         |
|   Stats Functions      | `count()`               | Counts the number of events.                                                                               | `... | stats count() as EventCount by event_simpleName`                                                                                                                                    |
|                        | `dc(FieldName)`         | Distinct count of values in a field.                                                                       | `... | stats dc(UserName) by ComputerName`                                                                                                                                                 |
|                        | `values(FieldName)`     | Lists all unique values of a field within each group.                                                      | `... | stats values(FileName) by ParentBaseFileName`                                                                                                                                       |
|                        | `earliest(FieldName)`   | Returns the earliest value of a field.                                                                     | `... | stats earliest(TimeGenerated_time) as FirstSeen by HashSHA256`                                                                                                                      |
|                        | `latest(FieldName)`     | Returns the latest value of a field.                                                                       | `... | stats latest(TimeGenerated_time) as LastSeen by HashSHA256`                                                                                                                       |
|                        | `sum(FieldName)`        | Sums numeric values.                                                                                       | `event_simpleName=NetworkConnectIP4 | stats sum(TotalOutboundByteCount) as TotalBytesSent by ComputerName`                                                                              |
|                        | `avg(FieldName)`        | Averages numeric values.                                                                                   | `event_simpleName=ProcessRollup2 | stats avg(ProcessDuration) as AvgDuration by FileName`                                                                                              |
| **Time Functions & Filtering** | `TimeGenerated_time`| Primary timestamp field for events.                                                                        | `TimeGenerated_time > "2023-10-26T00:00:00Z"` <br> (Often handled by the UI time picker, but can be specified in query)                                                                    |
|                        | `ProcessStartTime_time` | Timestamp for when a process started.                                                                      | `ProcessStartTime_time <= "now-1d"` (Example, relative time might need specific FQL syntax or UI)                                                                                      |
|                        | Date/Time Format      | ISO 8601 format (e.g., `YYYY-MM-DDTHH:MM:SSZ`).                                                            | `TimeGenerated_time > "2023-01-01T00:00:00Z" AND TimeGenerated_time < "2023-01-02T00:00:00Z"`                                                                                              |
| **Regular Expressions**| `rex` (via `where`)   | While FQL doesn't have a direct regex operator in the initial search, you can use `rex` with `where` for more complex pattern matching on fields after initial filtering (less common for basic searches). | `... | where rex field=CommandLine "(?i)mimikatz"` (Example, actual regex support might be limited or different)                                                                           |
|                        | String wildcards `*`    | Often sufficient for most pattern matching needs without full regex.                                       | `CommandLine="*password*dump*"`                                                                                                                                                    |
| **Comments** | `//`                    | Single-line comment.                                                                                       | `// Search for PowerShell execution` <br> `event_simpleName=ProcessRollup2 FileName=powershell.exe`                                                                                   |

**Common Event Types for Security Investigations:**
* `ProcessRollup2`: Process creation and metadata.
* `SyntheticProcessRollup2`: Similar to ProcessRollup2, often for processes that live for a very short time.
* `NetworkConnectIP4` / `NetworkConnectIP6`: TCP/UDP network connections.
* `DnsRequest`: DNS queries made by processes.
* `UserLogon`: User logon events.
* `FileCreation`: File creation events.
* `FileDeletion`: File deletion events.
* `ModuleLoad`: DLL or library loading by processes.
* `RegistrySetValue`: Registry value modifications.
* `ScriptControl`: Script execution events (e.g., PowerShell, VBScript).
* `DetectionSummaryEvent`: Summary of detections by Falcon.

This cheat sheet should serve as a good starting point for using CrowdStrike Falcon's Event Search for cybersecurity investigations. Always refer to the official CrowdStrike Falcon documentation for the most accurate and detailed FQL syntax and event schema information.
