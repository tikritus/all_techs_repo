# Splunk SPL Components Cheat Sheet for Cybersecurity Investigations

This cheat sheet provides a quick reference to common Splunk Search Processing Language (SPL) components used in cybersecurity analysis, including search commands, functions, filters, and aggregations.

**Note:**
* Field names (`user`, `src_ip`, `dest_port`, `EventCode`, etc.) are examples and will vary based on your data sources and CIM compliance.
* `your_index` and `your_sourcetype` should be replaced with actual values.
* This is not exhaustive but covers many frequently used components.

| Component Type         | SPL Component        | Description                                                                                                | Example Usage                                                                                                                               |
|------------------------|----------------------|------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------|
| **Core Search Commands**|                      |                                                                                                            |                                                                                                                                             |
| Search Command         | `search`             | The primary command to retrieve events from indexes. Can use keywords, field-value pairs, boolean operators. | `search index=your_index sourcetype=your_sourcetype EventCode=4625 user="*admin*"`                                                          |
| Search Command         | `from`               | Specifies the dataset to search from, often used with data models or lookups. (More advanced)               | `\| from datamodel:"Network_Traffic.All_Traffic"`                                                                                             |
| Search Command         | `tstats`             | Faster than `stats` for indexed fields when working with summarized data or specific data models.          | `\| tstats count from datamodel=Authentication where Authentication.action=failure by Authentication.user`                                    |
| **Filtering Commands** |                      |                                                                                                            |                                                                                                                                             |
| Filtering Command      | `where`              | Filters results using eval-style expressions (boolean conditions). Applied *after* `search`.                 | `... \| where status_code >= 400 AND bytes > 1000`                                                                                          |
| Filtering Command      | `dedup`              | Removes duplicate events based on specified fields. Keeps the first occurring event by default.            | `... \| dedup user, src_ip`                                                                                                                 |
| Filtering Command      | `head`               | Returns the first N results.                                                                               | `... \| head 10`                                                                                                                            |
| Filtering Command      | `tail`               | Returns the last N results.                                                                                | `... \| tail 5`                                                                                                                             |
| Filtering Command      | `regex`              | Filters events where a field matches a specified regular expression.                                       | `... \| regex user="^(admin\|root).*" `                                                                                                     |
| **Field Manipulation** |                      |                                                                                                            |                                                                                                                                             |
| Field Extraction       | `rex`                | Extracts fields from raw event data or existing fields using regular expressions.                          | `... \| rex field=raw_log "user=(?<username>\w+) src_ip=(?<source_ip>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})"`                                  |
| Field Extraction       | `extract` / `kv`     | Automatically extracts key-value pairs. `kv` is often used for `props.conf` based extractions.           | `... \| extract pairdelim="&", kvdelim="="` (Often implicit or configured in `props.conf`)                                                  |
| Field Creation/Modification | `eval`           | Calculates an expression and puts the resulting value into a new or existing field.                        | `... \| eval risk_score = (failed_logins * 10) + critical_alerts` <br> `... \| eval user=lower(user)`                                        |
| Field Renaming         | `rename`             | Renames one or more fields.                                                                                | `... \| rename dest_ip as DestinationIP, src_ip as SourceIP`                                                                                |
| Field Selection        | `fields`             | Specifies which fields to keep or remove from the results.                                                 | `... \| fields _time, user, src_ip, dest_ip, action` <br> `... \| fields - _raw, host`                                                       |
| **Grouping & Aggregation** |                   |                                                                                                            |                                                                                                                                             |
| Aggregation Command    | `stats`              | Calculates aggregate statistics (count, sum, avg, etc.) over the dataset, grouped by specified fields.     | `... \| stats count, dc(user) as distinct_users by src_ip, dest_port`                                                                       |
| Aggregation Command    | `eventstats`         | Similar to `stats`, but adds aggregate statistics to each event without removing original event details.   | `... \| eventstats avg(bytes) as avg_bytes_per_user by user`                                                                                |
| Aggregation Command    | `streamstats`        | Calculates statistics for each event at the time it is seen, often for running totals or time-based analysis. | `... \| streamstats count as event_num by session_id window=5`                                                                              |
| Aggregation Command    | `rare`               | Finds the least frequent values of fields.                                                                 | `... \| rare user, process_name limit=20`                                                                                                   |
| Aggregation Command    | `top`                | Finds the most frequent values of fields.                                                                  | `... \| top limit=10 user by action`                                                                                                        |
| Aggregation Command    | `chart`              | Creates data structures suitable for charting, similar to `stats` but often used for time-series or X/Y charts. | `... \| chart count over date_hour by user`                                                                                                 |
| Aggregation Command    | `timechart`          | Creates time-series charts with statistics aggregated over time buckets.                                   | `... \| timechart span=1h count by action`                                                                                                  |
| **Statistical Functions (used with `stats`, `eventstats`, `eval`, etc.)** | |                                                                                                      |                                                                                                                                             |
| Statistical Function   | `count`              | Counts the number of events.                                                                               | `... \| stats count by user`                                                                                                                |
| Statistical Function   | `dc` (distinct_count) | Counts the number of unique values for a field.                                                            | `... \| stats dc(src_ip) as unique_sources by dest_host`                                                                                    |
| Statistical Function   | `sum`                | Calculates the sum of numerical values.                                                                    | `... \| stats sum(bytes) as total_bytes by user`                                                                                            |
| Statistical Function   | `avg`                | Calculates the average of numerical values.                                                                | `... \| stats avg(duration) as avg_duration by process_name`                                                                                |
| Statistical Function   | `min`                | Finds the minimum value.                                                                                   | `... \| stats min(login_time) by user`                                                                                                      |
| Statistical Function   | `max`                | Finds the maximum value.                                                                                   | `... \| stats max(failed_attempts) by src_ip`                                                                                               |
| Statistical Function   | `stdev`              | Calculates the standard deviation.                                                                         | `... \| stats stdev(response_time) by server`                                                                                               |
| Statistical Function   | `median`             | Finds the median value.                                                                                    | `... \| stats median(file_size) by user`                                                                                                    |
| Statistical Function   | `perc<X>`            | Calculates the Xth percentile (e.g., `perc95`).                                                            | `... \| stats perc95(latency) as p95_latency`                                                                                               |
| Statistical Function   | `values`             | Lists all unique values of a field. (Use with care on high cardinality fields)                             | `... \| stats values(process_name) as processes_run by user`                                                                                |
| Statistical Function   | `list`               | Lists all values of a field, including duplicates. (Use with care)                                         | `... \| stats list(logon_type) by user`                                                                                                     |
| **Evaluation Functions (used with `eval`, `where`)** | |                                                                                                      |                                                                                                                                             |
| String Function        | `len`                | Returns the length of a string.                                                                            | `... \| eval command_length = len(command_line)`                                                                                            |
| String Function        | `lower`, `upper`     | Converts a string to lowercase or uppercase.                                                               | `... \| eval normalized_user = lower(user)`                                                                                                 |
| String Function        | `substr`             | Extracts a substring.                                                                                      | `... \| eval domain_name = substr(email, strpos(email, "@") + 1)`                                                                           |
| String Function        | `replace`            | Replaces parts of a string matching a regex with another string.                                           | `... \| eval clean_path = replace(file_path, "\\\\", "/")`                                                                                  |
| String Function        | `split`              | Splits a string by a delimiter into a multivalue field.                                                    | `... \| eval parts = split(full_path, "/")`                                                                                                 |
| String Function        | `mvjoin`             | Joins a multivalue field into a single string with a delimiter.                                            | `... \| eval joined_parts = mvjoin(parts, "-")`                                                                                             |
| Conditional Function   | `if`                 | Returns one of two values based on a boolean condition.                                                    | `... \| eval severity = if(error_code >= 500, "CRITICAL", "NORMAL")`                                                                        |
| Conditional Function   | `case`               | Evaluates multiple conditions and returns a corresponding value.                                           | `... \| eval threat_level = case(score > 90, "High", score > 60, "Medium", true(), "Low")`                                                   |
| Boolean Function       | `match`              | Returns true if a field value matches a regex pattern.                                                     | `... \| where match(process_name, ".*powershell.*")`                                                                                        |
| IP/Network Function    | `cidrmatch`          | Checks if an IP address falls within a CIDR range.                                                         | `... \| where cidrmatch("192.168.1.0/24", src_ip)`                                                                                           |
| Time Function          | `strftime`           | Formats a Unix timestamp into a human-readable string.                                                     | `... \| eval readable_time = strftime(_time, "%Y-%m-%d %H:%M:%S")`                                                                           |
| Time Function          | `strptime`           | Converts a string representation of time into a Unix timestamp.                                            | `... \| eval event_epoch = strptime(custom_time_field, "%m/%d/%Y:%H:%M:%S")`                                                                 |
| Time Function          | `relative_time`      | Converts a human-readable time (e.g., "-5m") into a Unix timestamp.                                        | `... \| where _time > relative_time(now(), "-1h")`                                                                                          |
| **Lookup Commands** |                      |                                                                                                            |                                                                                                                                             |
| Lookup Command         | `lookup`             | Enriches events by adding fields from a lookup file (CSV, KV store) based on matching fields.            | `... \| lookup user_department_lookup user OUTPUT department, location` <br> `... \| lookup threat_intel_ips src_ip OUTPUT is_malicious`       |
| Lookup Command         | `inputlookup`        | Reads a lookup file directly as search results.                                                            | `\| inputlookup append=t known_malicious_hashes.csv`                                                                                        |
| Lookup Command         | `outputlookup`       | Writes search results to a lookup file.                                                                    | `... \| outputlookup create_empty=true user_activity_summary.csv`                                                                           |
| **Transaction Command**|                      |                                                                                                            |                                                                                                                                             |
| Transaction Command    | `transaction`        | Groups events into transactions based on constraints like common fields, time span, or max events.       | `... \| transaction user session_id maxspan=30m maxpause=5m`                                                                                |
| **Subsearches** |                      |                                                                                                            |                                                                                                                                             |
| Subsearch              | `[search ...]`       | Uses the results of an inner search as an argument to an outer search (e.g., for filtering).             | `index=firewall [search index=malware_db earliest=-7d \| fields malicious_ip \| rename malicious_ip as dest_ip \| format]`                 |
| **Data Model & CIM** |                      |                                                                                                            |                                                                                                                                             |
| Data Model Search      | `datamodel`          | Uses pre-defined data models for searching normalized data (requires CIM compliance).                      | `\| from datamodel:Authentication.All_Authentication where user="john.doe"`                                                                 |
| CIM Field Naming       | (Concept)            | Common Information Model provides standardized field names for different data types (e.g., `src_ip`, `dest_port`). | `search sourcetype=pan:traffic action=allowed \| stats count by src_ip, dest_port` (Assumes CIM compliant field names)                   |

This cheat sheet should provide a solid reference for common Splunk SPL components used in cybersecurity. Remember to consult the official Splunk documentation for the most detailed and up-to-date information.
