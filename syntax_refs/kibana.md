# Kibana KQL Cheat Sheet for Cybersecurity Investigations

This cheat sheet provides a quick reference to common Kibana Query Language (KQL) syntax used in the Kibana Discover app for cybersecurity analysis.

**Note:**
* Field names (`user.name`, `source.ip`, `destination.port`, `event.code`, etc.) are examples and will vary based on your data sources, ECS (Elastic Common Schema) compliance, or custom mappings.
* `your-index-pattern-*` is a placeholder for your actual index pattern.
* KQL is the default query language in Kibana Discover.

| Component Type              | KQL Component / Concept | Description                                                                                                   | Example Usage (KQL)                                                                                                                                                                 |
|-----------------------------|-------------------------|---------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Basic Querying** |                         |                                                                                                               |                                                                                                                                                                                                       |
| Simple Match                | `field: value`          | Finds documents where the field contains the value (analyzed). For exact matches on keywords, use `.keyword`. | `response_code: 200` <br> `user.name: "john.doe"` <br> `message: "login failed"` <br> `user.name.keyword: "Administrator"`                                                                  |
| Free Text Search            | `value`                 | Searches the value across default fields configured in the index pattern.                                     | `"fatal error"`                                                                                                                                                                       |
| **Boolean Operators** |                         |                                                                                                               |                                                                                                                                                                                                       |
| AND                         | `and`                   | Both terms must be present. (Implicit if multiple `field:value` pairs are used without an operator).        | `source.ip: 192.168.1.100 and destination.port: 80` <br> `event.action: login and event.outcome: success`                                                                                 |
| OR                          | `or`                    | Either term can be present.                                                                                   | `event.code: 401 or event.code: 403` <br> `process.name: cmd.exe or process.name: powershell.exe`                                                                                        |
| NOT                         | `not`                   | Excludes documents containing the term.                                                                       | `not destination.ip: 10.0.0.0/8` <br> `user.name: "guest" and not event.action: logout`                                                                                                     |
| **Grouping** |                         |                                                                                                               |                                                                                                                                                                                                       |
| Parentheses                 | `( )`                   | Groups terms to control the order of operations for boolean logic.                                            | `(source.ip: 1.2.3.4 or source.ip: 5.6.7.8) and destination.port: 443`                                                                                                                 |
| **Field-Based Queries** |                         |                                                                                                               |                                                                                                                                                                                                       |
| Exists                      | `field:*`               | Finds documents where the field exists and has any value (is not null).                                     | `user.email:*`                                                                                                                                                                           |
| Does Not Exist              | `not field:*`           | Finds documents where the field does not exist or is null.                                                  | `not user.department:*`                                                                                                                                                                  |
| **Range Queries** |                         |                                                                                                               |                                                                                                                                                                                                       |
| Numeric/Date Ranges         | `field > value` <br> `field >= value` <br> `field < value` <br> `field <= value` | Finds documents where a numeric or date field is greater than, less than, etc. a value.                     | `response_code >= 400` <br> `@timestamp > "now-1h"` <br> `source.bytes > 10000 and source.bytes <= 50000`                                                                              |
| Nested Field Ranges         | `parent_field.child_field > value` | Allows range queries on nested fields.                                                                  | `object.attribute.count >= 5`                                                                                                                                                           |
| **Wildcard Queries** |                         |                                                                                                               |                                                                                                                                                                                                       |
| Wildcards                   | `*`, `?`                | `*` matches multiple characters. `?` matches a single character. Avoid leading wildcards for performance.   | `process.name: power*.exe` <br> `file.path: /var/log/auth?.log`                                                                                                                               |
| **Phrase Searching** |                         |                                                                                                               |                                                                                                                                                                                                       |
| Exact Phrase                | `field: "exact phrase"` | Matches the exact sequence of terms.                                                                          | `message: "user login successful"`                                                                                                                                                       |
| **Kibana Specifics** |                         |                                                                                                               |                                                                                                                                                                                                       |
| Index Pattern Selection     | (UI Element)            | Select the correct index pattern in Discover to search against the desired data.                            | N/A (UI interaction)                                                                                                                                                                    |
| Time Picker                 | (UI Element)            | Crucial for scoping investigations to specific timeframes.                                                    | N/A (UI interaction, but affects results of all queries)                                                                                                                                  |
| Filters                     | (UI Element - Add filter) | Add structured filters using the UI for specific field-value pairs, ranges, exists, etc.                    | N/A (UI interaction, complements search bar queries)                                                                                                                                        |
| Saved Queries               | (UI Element)            | Save frequently used or complex queries for reuse.                                                            | N/A (UI interaction)                                                                                                                                                                    |
| **Aggregations & Visualizations** |                     |                                                                                                               |                                                                                                                                                                                                       |
| UI Driven                   | Lens, Visualize, Dashboards| Kibana excels at UI-driven aggregations and visualizations rather than complex aggregation queries in the Discover search bar. The search bar filters data *for* these visualizations. | Example: To count events by `user.name`, you'd type `*` in Discover, then use the "Visualize" or "Lens" app to create a terms aggregation on `user.name.keyword`.                              |

This KQL-focused cheat sheet should be a handy reference for your cybersecurity investigations in Kibana.
